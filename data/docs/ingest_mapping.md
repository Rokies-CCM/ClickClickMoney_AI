---
title: 인입 매핑 규칙 (CSV → Facts)
version: 1.5
last_updated: 2025-10-19
locale: ko-KR
---

# 인입 매핑 규칙 (CSV → Facts)

## 1) 업로드 요건(서버 구현과 일치)
- **콘텐츠 타입**: `text/csv`, `application/csv`, (일부) `application/vnd.ms-excel`
- **최대 용량**: 기본 5MB (`MAX_UPLOAD_MB`)
- **파일명**: `.csv` 확장자 필수
- **인코딩**: `utf-8-sig` 권장(BOM 허용), 실패 시 `utf-8`(ignore) 복구
- **월 필터**: `month=YYYY-MM` (선택)

## 2) 스키마
필수 컬럼(헤더 대소문자 구분 없음):
- `date` (예: `2025-07-03`)
- `category` (예: `교통`, `식비`, `배달`, `카페`…)
- `amount` (예: `12,300`, `￦ 5,000`, `3000원`)
- `memo` (자유 텍스트: 상호/메모)

검증 실패 시 400: `INVALID_HEADERS`, `INVALID_CONTENT_TYPE`, `FILE_TOO_LARGE`, `INVALID_MONTH` 등.

## 3) 정규화 규칙
- **금액 파싱**: 숫자·기호 혼합에서 최종 숫자만 추출 → 정수원화(원 단위)
  - 허용 예: `₩12,300`, `12,300원`, `3000`
- **카테고리 매핑**(예시):
  - `교통`: 버스/지하철/택시/카카오T/고속버스/톨비/주차/코레일/KTX…
  - `식비`: 점심/저녁/식사/카페/커피/편의점/배달/요기요/쿠팡이츠/배민…
- **빈도 추정**(메모 기반):
  - 점심 힌트: `점심`, `런치`, `lunch`
  - 저녁 힌트: `저녁`, `디너`, `dinner`, `야식`

## 4) 집계 → Facts
누적치 계산:
- `교통비` = 교통 카테고리 합계
- `식비` = 식비 카테고리 합계
- `점심빈도` = 월 X일
- `저녁빈도` = 월 X일

예시 결과(JSON):
```json```
{
  "facts": {
    "교통비": "45,000원",
    "식비": "320,000원",
    "점심빈도": "월 17일",
    "저녁빈도": "월 12일"
  },
  "info": {
    "month": "2025-07",
    "sum_transport": 45000,
    "sum_food": 320000,
    "lunch_days": 17,
    "dinner_days": 12,
    "rows": 123
  }
}

## 5) 파생 수치(서버)
- 예: 교통비/식비가 존재하면 **한도 제안**을 생성(–50,000 / 100,000 등).
- 출력 시 **수치 가드**가 적용되므로, 컨텍스트 외 값은 자동 마스킹됨.

## 6) 에러/보안
- 응답 에러는 {error:{code,message,trace_id}} 표준 형식.
- 비허용 링크/수치는 답변 스트림에서 자동 정제([링크 생략], [수치 생략]).