---
title: 문제해결 가이드
version: 1.4
last_updated: 2025-10-19
locale: ko-KR
---

# 문제해결 가이드

## 1) RAG/인덱스
**증상**: 인덱스가 안 늘어나거나 검색이 비정상  
**점검**  
- [ ] 파일 확장자: `.md`/`.txt`  
- [ ] 인코딩: `UTF-8(또는 UTF-8 with BOM)`  
- [ ] 경로: `DOCS_DIR`가 실제 폴더와 일치  
- [ ] 중복/대용량 문단: `CHUNK_SIZE(800~1200)` / `CHUNK_OVERLAP(150~250)` 조정  
- [ ] 인덱스 존재 로그: `core/rag.py` warn-once 메시지 확인(FAISS/Chroma 로드 실패)

## 2) 검색 정밀도
**증상**: 검색 결과가 기대와 다름  
**점검**  
- [ ] `TOP_K=4`(기본) → 짧은 질문에서는 **2~3**으로 낮춰 과적합 방지  
- [ ] `FAISS_EF_SEARCH=160`(권장)  
- [ ] 긴 질문(≥120자)에서만 **rerank** 동작하는지 확인(`USE_RERANK`)  
- [ ] 문서 중복/표현 통일(동의어·표기 통일)

## 3) 응답 지연/비용
**증상**: 느리거나 비용이 높음  
**점검**  
- [ ] `TOP_K 2~3`, `MAX_CONTEXT_CHARS 1000~1400`  
- [ ] `USE_RERANK=false`로 비용 절감(필요시만 on)  
- [ ] 모델 라우팅 과도 전환 여부(단문이 OpenAI로 가는지)  
- [ ] 의미 캐시(0.90) 적중률 점검, 질의 정규화 재검토

## 4) 숫자/링크 차단
**증상**: 숫자/링크가 “막힌” 듯 보임  
**원인**: **가드 정책 정상 동작**  
- 수치: 컨텍스트/RAG/사용자 facts/파생에 **없는 숫자** → 자동 `[수치 생략]`  
- 링크: 허용 host가 아닌 URL → 자동 `"[링크 생략]"`  
**조치**  
- [ ] 근거가 되는 수치/출처를 컨텍스트에 포함  
- [ ] 화이트리스트 host를 포함한 `sources` 또는 허용 스니펫 사용

## 5) 서버/네트워크
**증상**: 5xx/타임아웃  
**점검**  
- [ ] 전역 예외 응답은 **trace_id**만 노출 → 서버 로그에서 추적  
- [ ] `httpx` 타임아웃/리밋: CONNECT 5s / READ·WRITE 60s / HTTP2 on  
- [ ] CORS: 운영에선 `CORS_ORIGINS`를 **도메인 목록**으로 제한

## 6) 체크리스트(요약)
- [ ] 인덱스 경고 없음, `TOP_K/efSearch` 적정  
- [ ] rerank 과다 호출 아님  
- [ ] 캐시 적중률 ≥ 0.70  
- [ ] `[수치/링크 생략]` 발생 시 컨텍스트 보강
