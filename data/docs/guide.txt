title: ai-chatbot 운영 가이드
version: 1.3
last_updated: 2025-10-19
locale: ko-KR

[목적]
- 앱테크 미션, 가계부 분석, 투자 스냅샷, AI 절약 코치를 단일 챗봇 인터페이스로 제공
- "짧고 정확한" 실행 제안과 주간 1개 액션을 일관되게 안내

[핵심 원칙]
- 숫자/퍼센트/빈도는 컨텍스트/RAG/사용자 facts/파생 수치에 있는 값만 출력
- 외부 링크는 RAG source 기반 화이트리스트 host만 허용(그 외는 [링크 생략])
- 답변 구조: 2~3문장 요약 → 실행 불릿 2~3개 → 이번 주 액션 1개

[아키텍처(요약)]
- API: FastAPI (/v1/chat SSE, /v1/ingest/ledger, /v1/health, /v1/metrics)
- 모델 라우팅: 간단문답→Groq 8B / 장문·근거·법령→업스케일 또는 OpenAI
- RAG: FAISS(HNSW) 인덱스 + 문서 클리핑(1000/200)
- 가드: host 화이트리스트 URL 필터 + 수치 가드(허용 토큰 외 [수치 생략])
- 캐시: 의미 캐시(유사도 0.90) + 응답 캐시

[엔드포인트]
- POST /v1/chat (SSE 기본)  : 질문 → 스트리밍 답변
- POST /v1/ingest/ledger     : CSV→facts/파생 수치 추출(5MB, CSV만)
- GET  /v1/health            : 상태 확인
- GET  /v1/metrics           : 경량 운영 메트릭
- GET  /v1/bench/recent      : 최근 요청 요약

[환경 변수(요약)]
- 모델키: OPENAI_API_KEY, GROQ_API_KEY, (옵션)UPSTAGE_API_KEY
- 동작: REPLY_MAX_TOKENS, STOP_TOKENS, USE_TAVILY, USE_RERANK
- RAG : VECTOR_BACKEND, VECTOR_DB, EMBEDDING_MODEL, FAISS_EF_SEARCH
- 서버: CORS_ORIGINS, DEBUG, MAX_UPLOAD_MB

[비목표(Out of scope)]
- 개인 금융/수익 보장, 투자 권유, 의료/법률 자문 확정 표현
- 출처 불명 수치/외부 평균값 제시

[운영 체크]
- 에러 응답은 trace_id만 노출, 내부 메시지/스택 비노출
- 캐시 히트율/지연 p95/토큰 평균을 주기적으로 점검



